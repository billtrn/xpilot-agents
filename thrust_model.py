from math import exp


def normalize_data(data, minmax):
    for point in data:
        for i in range(len(point) - 1):
            point[i] = (point[i] - minmax[i][0]) / (minmax[i][1] - minmax[i][0])

    return data


def predict_thrust(point):
    minmax = [
        [0.0, 39.824615503479755],
        [107.0, 1245.0],
        [32.0, 1053.0],
        [90.0, 986.0],
        [103.0, 1039.0],
        [12.0, 948.0],
        [65.0, 961.0],
        [0, 1]
    ]

    network = [
        [
            {
                'weights': [
                    3.5539792567583186,
                    29.13718573065712,
                    2.165174961549677,
                    -4.169834422367193,
                    0.9569306018125378,
                    -15.132219243099744,
                    -10.162207272396858,
                    -14.743209391922901
                ],
                'output': 0.016006741786138944,
                'delta': -0.001701029364641218
            },
            {
                'weights': [
                    1.2438150351578805,
                    0.7505827126275593,
                    -2.2599295175620555,
                    -2.6889539769470363,
                    1.5254321812079072,
                    -3.34188320632796,
                    0.30321953824482484,
                    -2.994016091153805
                ],
                'output': 0.011549187439242927,
                'delta': -0.001357100905034505
            },
            {
                'weights': [
                    7.304817340149394,
                    4.476808973969489,
                    -10.75523787609768,
                    -9.135307598031389,
                    -4.7611386853180315,
                    1.0633122430446476,
                    4.983293642580368,
                    -4.093165716432734
                ],
                'output': 1.0045839399719852e-05,
                'delta': -1.695075633620443e-06
            },
            {
                'weights': [
                    41.63730206109319,
                    8.401233901910826,
                    -27.004315115452158,
                    -29.799393029980532,
                    -12.752196480578109,
                    -4.014704012730149,
                    12.88267564804839,
                    -17.72424769678403
                ],
                'output': 6.619229786958189e-19,
                'delta': 8.2115547707595985e-19
            },
            {
                'weights': [
                    -3.6730706277662244,
                    -21.24261802945163,
                    8.195772900417843,
                    -1.615878066556373,
                    4.965620906536904,
                    -3.389374498152534,
                    2.3384015605087245,
                    0.4386821197191453
                ],
                'output': 0.00025959554034727734,
                'delta': -5.0690258158727364e-05
            },
            {
                'weights': [
                    70.42948409743398,
                    27.130992972351777,
                    8.129032758716235,
                    -12.902897767127534,
                    -18.000454360795725,
                    -13.695352071423528,
                    -18.486321398870082,
                    -31.397238357807126
                ],
                'output': 1.4022691595656756e-15,
                'delta': 1.4297250694422335e-15
            },
            {
                'weights': [
                    -1.4919398452260422,
                    1.722324819886941,
                    -2.4632578002651955,
                    -0.8072290124670164,
                    -0.18426059382557325,
                    -1.4084744677015415,
                    0.2809064681485286,
                    -2.145263541603207
                ],
                'output': 0.04751516777600966,
                'delta': -0.005395636756068345
            },
            {
                'weights': [
                    18.169052675320835,
                    -15.274257518274945,
                    -10.536724838825657,
                    -4.961020817041632,
                    12.178097498090406,
                    -13.428232711646777,
                    3.7861290961647764,
                    -1.3566213380496115
                ],
                'output': 0.00021146085497929232,
                'delta': -6.101755211248891e-05
            },
            {
                'weights': [
                    6.431234973707393,
                    -2.8400710924813137,
                    -4.611455276040493,
                    -3.881148233200464,
                    5.9838710928761305,
                    -8.743764518076297,
                    1.1206046500118847,
                    -3.282576342683475
                ],
                'output': 0.003552950321145502,
                'delta': -0.00043985151589376266
            },
            {
                'weights': [
                    -0.7479801488974706,
                    -3.9053098327306657,
                    -56.13607268141026,
                    -7.857849497484361,
                    11.414158321282322,
                    -5.642604754466113,
                    13.265634928288724,
                    5.968137664783705
                ],
                'output': 0.00015793610193797007,
                'delta': 4.4847018115139725e-05
            },
            {
                'weights': [
                    2.6152456105651907,
                    -0.6651827516440304,
                    -2.6100254204471445,
                    -3.0971451390877727,
                    2.6343902609741994,
                    -5.0071643240125425,
                    0.2819635243082793,
                    -2.7073000492681922
                ],
                'output': 0.007679415532794413,
                'delta': -0.0009602241753677824
            },
            {
                'weights': [
                    -1.0790325097014035,
                    1.4350154105624597,
                    -2.6009725085806084,
                    -1.2111217446238347,
                    -0.13582309977295792,
                    -1.4252057469528403,
                    -0.17930567023935792,
                    -1.662302301680458
                ],
                'output': 0.04382580954237421,
                'delta': -0.005095342387001323
            },
            {
                'weights': [
                    4.524457691745568,
                    8.509175722295456,
                    -6.800575274433913,
                    -7.182927570344085,
                    6.583145600537432,
                    -13.191921968696384,
                    1.512940472787256,
                    -6.751826118039403
                ],
                'output': 0.004189092960215097,
                'delta': -0.0008456163589393241
            },
            {
                'weights': [
                    -8.931759411679172,
                    16.34657462189937,
                    -4.952982517021199,
                    -5.681858535429226,
                    -24.8504272917602,
                    12.635574828881065,
                    -6.62561345005794,
                    -12.629269563292594
                ],
                'output': 2.9057126518621993e-12,
                'delta': -9.642513472083517e-13
            },
            {
                'weights': [
                    24.637200421921353,
                    -8.443985498173419,
                    -77.79242502219249,
                    20.038453512479148,
                    9.353274913847983,
                    -13.611037071537188,
                    -24.4530550120401,
                    -4.934874824868151
                ],
                'output': 1.7218281922216507e-11,
                'delta': 1.8085550216679783e-11
            },
            {
                'weights': [
                    8.641127586465721,
                    -40.800849538726496,
                    -0.5742268284686677,
                    3.804264390405466,
                    5.066500406781802,
                    -0.08320956778306453,
                    1.3216126477112857,
                    4.801944396766433
                ],
                'output': 1.0938700039993387e-06,
                'delta': -3.750090966687124e-07
            },
            {
                'weights': [
                    4.950413665105269,
                    -1.3493904094959013,
                    -3.7766023634772057,
                    -3.8976022975167717,
                    5.172915559011059,
                    -7.296237054298342,
                    0.655816158919559,
                    -3.689972263831865
                ],
                'output': 0.004400723623496207,
                'delta': -0.0005051267556660942
            },
            {
                'weights': [
                    12.358252418414569,
                    -0.36945994204475235,
                    -22.436057503810556,
                    -6.793043240445672,
                    -4.635070897593044,
                    -1.0378470565368156,
                    0.8498257302091133,
                    -6.07991037875278
                ],
                'output': 1.7292020193396178e-09,
                'delta': 9.49858465794063e-10
            },
            {
                'weights': [
                    -1.1763825347016648,
                    1.452329933309228,
                    -2.546559095927108,
                    -1.1864242170982784,
                    -0.15470580271789044,
                    -1.4532410932631632,
                    -0.14933682809666024,
                    -1.6552419534686416
                ],
                'output': 0.04504621928121716,
                'delta': -0.005233856537037838
            },
            {
                'weights': [
                    -2.084009969069592,
                    -9.711976627185866,
                    29.222578632189435,
                    -25.27039070919621,
                    16.71160985119279,
                    -34.91546754086233,
                    6.72067050056438,
                    -19.216682987842155
                ],
                'output': 4.198105095358333e-12,
                'delta': 2.204488771513968e-12
            }
        ],
        [
            {
                'weights': [
                    1.2769570386359634,
                    1.7156380646263734,
                    1.984912862166475,
                    -14.5698012310936,
                    2.295790920020888,
                    -12.03079168255768,
                    1.627722963398193,
                    3.423801789166335,
                    1.3629334851799941,
                    -3.344999799460191,
                    1.4150281679597245,
                    1.2343886130651078,
                    2.3962468145760587,
                    3.917822920074886,
                    -12.401292140284182,
                    4.041722843085396,
                    1.2855697689496985,
                    -6.530511801745669,
                    1.2885874840507163,
                    -6.1845065810669295,
                    0.9993788990029338
                ],
                'output': 0.7641883055762021,
                'delta': -0.04249433773085128
            },
            {
                'weights': [
                    -1.2730072507225156,
                    -1.088790125655792,
                    -1.9949323932724676,
                    14.690467547623134,
                    -2.3110557268067673,
                    12.017093259234453,
                    -1.1912988556839799,
                    -3.38341159316807,
                    -1.5684837821944866,
                    3.353484867067341,
                    -1.5586007180699049,
                    -1.6418627809724482,
                    -2.385594098832753,
                    -3.9091312509056926,
                    12.37276139257816,
                    -4.044266860685364,
                    -1.4347590345028693,
                    6.425204473927481,
                    -1.5894428273033383,
                    6.200954986062107,
                    -0.9966998497645483
                ],
                'output': 0.23517810567601605,
                'delta': 0.04230133636208517
            }
        ]
    ]
    point = normalize_data([point], minmax)[0]
    outputs = forward_propagate(network, point)
    return outputs.index(max(outputs))


def forward_propagate(network, point):
    inp = point
    for layer in network:
        next_layer_inp = []

        for neuron in layer:
            activation = activate(neuron['weights'], inp)
            neuron['output'] = calculate_sigmoid(activation)
            next_layer_inp.append(neuron['output'])

        inp = next_layer_inp

    return inp


def activate(weights, inputs):
    activation = weights[-1]
    for i in range(len(weights) - 1):
        activation += weights[i] * inputs[i]
    return activation


def calculate_sigmoid(activation):
    try:
      return 1.0 / (1.0 + exp(- activation))
    except Exception:
      return 0
    
